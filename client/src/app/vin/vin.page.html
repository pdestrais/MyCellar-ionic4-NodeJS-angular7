<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>
      {{'page.wine' | translate }}
    </ion-title>
  </ion-toolbar>
</ion-header>
<ion-content padding id="page2">
  <form [formGroup]="vinForm" id="vin-form4">
    <form [formGroup]="nameYearForm">
      <ion-item id="vin-input4">
        <ion-label position="floating">
          {{'wine.name' | translate }}
        </ion-label>
        <ion-input [(ngModel)]="vin.nom" type="text" placeholder="Nom du vin" formControlName="nom" text-right
          [class.invalid]="!nameYearForm.controls.nom.valid && (nameYearForm.controls.nom.dirty || submitted)"></ion-input>
      </ion-item>
      <ion-item *ngIf="!nameYearForm.controls.nom.valid  && (nameYearForm.controls.nom.dirty || submitted)">
        <p class="invalid">{{'wine.name' | translate }} {{"general.required" | translate }}</p>
      </ion-item>
      <ion-item id="vin-input5">
        <ion-label position="floating">
          {{'wine.year' | translate }}
        </ion-label>
        <ion-input [(ngModel)]="vin.annee" type="text" placeholder="AnnÃ©e" formControlName="annee" text-right
          [class.invalid]="!nameYearForm.controls.annee.valid && (nameYearForm.controls.annee.dirty || submitted)"></ion-input>
      </ion-item>
      <ion-item *ngIf="!nameYearForm.controls.annee.valid  && (nameYearForm.controls.annee.dirty || submitted)">
        <p class="invalid">{{'wine.year' | translate }} {{"general.required" | translate }} {{'general.or' | translate
          }} {{'wine.minmax' | translate }}</p>
      </ion-item>
      <p *ngIf="vinForm.get('nameYearForm').hasError('double')" [class.invalid]="vinForm.get('nameYearForm').hasError('double')">{{
        'wine.double' | translate }}</p>
    </form>
    <ion-item id="vin-select1">
      <ion-label position="floating">
        {{'wine.type' | translate }}
      </ion-label>
      <ion-select [(ngModel)]="vin.type._id" formControlName="type" interface="popover" (ionChange)="typeChange($event)">
        <ion-select-option *ngFor="let type of types" [value]="type._id">
          {{type.nom | translate }}
        </ion-select-option>
      </ion-select>
    </ion-item>
    <ion-item *ngIf="!vinForm.controls.type.valid  && (vinForm.controls.type.dirty || submitted)">
      <p class="invalid">{{'wine.type' | translate }} {{"general.required" | translate }}</p>
    </ion-item>
    <ion-item id="vin-select2">
      <ion-label position="floating">
        {{'wine.origin' | translate }}
      </ion-label>
      <ion-select [(ngModel)]="vin.origine._id" formControlName="origine" (ionChange)="origineChange($event)">
        <ion-select-option *ngFor="let origine of origines" [value]="origine._id">
          {{origine.pays}} - {{ origine.region }}
        </ion-select-option>
      </ion-select>
    </ion-item>
    <ion-item *ngIf="!vinForm.controls.origine.valid  && (vinForm.controls.origine.dirty || submitted)">
      <p class="invalid">{{'wine.origine' | translate }} {{"general.required" | translate }}</p>
    </ion-item>
    <ion-item id="vin-select3">
      <ion-label position="floating">
        {{'wine.appellation' | translate }}
      </ion-label>
      <ion-select [(ngModel)]="vin.appellation._id" formControlName="appellation" (ionChange)="appellationChange($event)">
        <ion-select-option *ngFor="let appellation of appellations" [value]="appellation._id">
          {{appellation.courte}} - {{ appellation.longue }}
        </ion-select-option>
      </ion-select>
    </ion-item>
    <ion-item *ngIf="!vinForm.controls.appellation.valid  && (vinForm.controls.appellation.dirty || submitted)">
      <p class="invalid">{{'wine.appellation' | translate }} {{"general.required" | translate }}</p>
    </ion-item>
    <ion-item id="vin-input15">
      <ion-label position="floating">
        {{'wine.grape' | translate }}
      </ion-label>
      <ion-input [(ngModel)]="vin.cepage" type="text" placeholder="100% Cabernet, ..." text-right [ngModelOptions]="{standalone: true}"></ion-input>
    </ion-item>
    <ion-item id="vin-input6">
      <ion-label position="floating">
        {{'wine.bottlesPurchase' | translate }}
      </ion-label>
      <ion-input [(ngModel)]="vin.nbreBouteillesAchat" type="number" placeholder="Nbre bouteilles achat"
        formControlName="nbreBouteillesAchat" text-right [class.invalid]="!vinForm.controls.nbreBouteillesAchat.valid && (vinForm.controls.nbreBouteillesAchat.dirty || submitted)"
        (blur)="toNumber('nbreBouteillesAchat')"></ion-input>
    </ion-item>
    <ion-item *ngIf="!vinForm.controls.nbreBouteillesAchat.valid  && (vinForm.controls.nbreBouteillesAchat.dirty || submitted)">
      <p class="invalid">{{'wine.bottlesPurchase' | translate }} {{"general.required" | translate }}</p>
    </ion-item>
    <ion-item id="vin-input12">
      <ion-label position="floating">
        {{'wine.bottlesLeft' | translate }}
      </ion-label>
      <ion-input [(ngModel)]="vin.nbreBouteillesReste" type="number" placeholder="Nbre bouteilles restantes"
        formControlName="nbreBouteillesReste" text-right [class.invalid]="!vinForm.controls.nbreBouteillesReste.valid && (vinForm.controls.nbreBouteillesReste.dirty || submitted)"
        (blur)="toNumber('nbreBouteillesReste')"></ion-input>
    </ion-item>
    <ion-item *ngIf="!vinForm.controls.nbreBouteillesReste.valid  && (vinForm.controls.nbreBouteillesReste.dirty || submitted)">
      <p class="invalid">{{'wine.bottlesLeft' | translate }} {{"general.required" | translate }}</p>
    </ion-item>
    <ion-item id="vin-input8">
      <ion-label position="floating">
        {{'wine.price' | translate }}
      </ion-label>
      <ion-input [(ngModel)]="vin.prixAchat" type="text" placeholder="Prix" formControlName="prixAchat" text-right
        [class.invalid]="!vinForm.controls.prixAchat.valid && (vinForm.controls.prixAchat.dirty || submitted)" (blur)="toNumber('prixAchat')"></ion-input>
    </ion-item>
    <ion-item *ngIf="!vinForm.controls.prixAchat.valid  && (vinForm.controls.prixAchat.dirty || submitted)">
      <p class="invalid">{{'wine.price' | translate }} {{"general.required" | translate }} {{'general.or' | translate
        }} {{'wine.priceFormatInvalid' | translate }}</p>
    </ion-item>
    <ion-item id="vin-input9">
      <ion-label position="floating">
        {{'wine.purchaseDate' | translate }}
      </ion-label>
      <ion-input [(ngModel)]="vin.dateAchat" type="date" placeholder="Date achat" formControlName="dateAchat"
        text-right [class.invalid]="!vinForm.controls.dateAchat.valid && (vinForm.controls.dateAchat.dirty)"></ion-input>
    </ion-item>
    <ion-item *ngIf="!vinForm.controls.dateAchat.valid  && (vinForm.controls.dateAchat.dirty || submitted)">
      <p class="invalid">{{'wine.bottlesPurchase' | translate }} {{"general.required" | translate
        }}{{'wine.buyDateRequired' | translate }}</p>
    </ion-item>
    <ion-item id="vin-input10">
      <ion-label position="floating">
        {{'wine.location' | translate }}
      </ion-label>
      <ion-input [(ngModel)]="vin.localisation" type="text" placeholder="Localisation D/G.y.x" formControlName="localisation"
        text-right [class.invalid]="!vinForm.controls.localisation.valid && (vinForm.controls.localisation.dirty || submitted)"></ion-input>
    </ion-item>
    <ion-item *ngIf="!vinForm.controls.localisation.valid  && (vinForm.controls.localisation.dirty || submitted)">
      <p class="invalid">{{'wine.location' | translate }} {{"general.required" | translate }}</p>
    </ion-item>
    <ion-item id="vin-input11">
      <ion-label position="floating">
        {{'wine.contains' | translate }}
      </ion-label>
      <ion-input [(ngModel)]="vin.contenance" type="text" placeholder="75 - 150 cl" text-right [ngModelOptions]="{standalone: true}"></ion-input>
    </ion-item>
    <ion-item id="vin-input12">
      <ion-label position="floating">
        {{'wine.apogee' | translate }}
      </ion-label>
      <ion-input [(ngModel)]="vin.apogee" type="text" placeholder="ex: 2020-2025" formControlName="apogee" text-right
        [class.invalid]="!vinForm.controls.apogee.valid && (vinForm.controls.apogee.dirty || submitted)"></ion-input>
    </ion-item>
    <ion-item *ngIf="!vinForm.controls.apogee.valid  && (vinForm.controls.apogee.dirty || submitted)">
      <p class="invalid">{{'wine.apogee' | translate }} {{"wine.apogeeFormat" | translate }}</p>
    </ion-item>
    <ion-item id="vin-input14">
      <ion-label>
        {{'wine.GWSScore' | translate }}
      </ion-label>
      <ion-input [(ngModel)]="vin.GWSScore" type="number" placeholder="85.7" text-right [ngModelOptions]="{standalone: true}"></ion-input>
      <ion-button class="padBefore" fill="outline" (click)="getGWSScore()">
        <ion-icon slot="end" name="arrow-dropright"></ion-icon>
        fetch
      </ion-button>
    </ion-item>
    <ion-grid>
      <ion-row>
        <ion-col size=auto>
          <ion-label>
            Photo
          </ion-label>
          <div *ngIf="selectedImg.length!=0">
            <label for="uploadphoto">{{'changeImage' | translate }}</label>
          </div>
          <input #uploadphoto type="file" name="photo" id="uploadphoto" (change)="showImage()" />
        </ion-col>
        <ion-col>
          <div *ngIf="selectedImg.length==0">
            <label for="uploadphoto" class="nophoto">{{'addImage' | translate }}</label>
          </div>
          <div class="ion-canvas">
            <canvas #canvas height="0" width="0"></canvas>
          </div>
        </ion-col>
      </ion-row>
    </ion-grid>
    <ion-button fill="outline" expand="full" (click)="showHistory()">
      <ion-icon slot=" end" name="arrow-dropright">
      </ion-icon>
      {{'wine.history' | translate }}
    </ion-button>
  </form>
  <ion-button [disabled]="!vinForm.valid" id="vin-button1" color="primary" expand="full" (click)="saveVin()">
    {{'general.save' | translate }}
  </ion-button>
  <ion-button id="vin-button3" color="secondary" expand="full" (click)="addComment()">
    {{'general.add' | translate }} {{'wine.comment' | translate }}
  </ion-button>
  <ion-button id="vin-button2" color="danger" expand="full" (click)="deleteVin()">
    {{'general.suppress' | translate }}
  </ion-button>
</ion-content>